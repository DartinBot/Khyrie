<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Khyrie Fitness - Full Platform Test</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Khyrie Fitness">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="FamilyFriends.css">
    <link rel="stylesheet" href="SharedWorkout.css">
    <link rel="stylesheet" href="WeightTracker.css">
    <link rel="stylesheet" href="ExerciseJournal.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .api-test {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèãÔ∏è‚Äç‚ôÄÔ∏è Family & Friends Fitness - Local Testing Dashboard</h1>
        
        <div class="test-section">
            <h2>üöÄ API Server Status</h2>
            <div class="api-test">
                <button onclick="testAPIStatus()">Test API Connection</button>
                <div id="api-status" class="result"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üë• Phase 1: Family & Friends Features</h2>
            <div class="api-test">
                <button onclick="testFamilyFeatures()">Test Group Management</button>
                <div id="family-results" class="result"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üéì Phase 2: Skill Sharing & Mentorship</h2>
            <div class="api-test">
                <button onclick="testSkillSharing()">Test Skill Sessions</button>
                <div id="skill-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testMentorship()">Test Mentor Matching</button>
                <div id="mentor-results" class="result"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ü§ù Phase 3: Real-time Partner Coordination</h2>
            <div class="api-test">
                <button onclick="testPartnerMatching()">Test Partner Finding</button>
                <div id="partner-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testCommunityFeatures()">Test Community Discovery</button>
                <div id="community-results" class="result"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üèÜ Community Leaderboards</h2>
            <div class="api-test">
                <button onclick="testLeaderboards()">Test Leaderboards</button>
                <div id="leaderboard-results" class="result"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>‚öñÔ∏è Weight Tracking System</h2>
            <div class="api-test">
                <button onclick="testWeightLogging()">Test Weight Logging</button>
                <div id="weight-log-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testWeightHistory()">Test Weight History</button>
                <div id="weight-history-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testFamilyWeightProgress()">Test Family Progress</button>
                <div id="family-weight-results" class="result"></div>
            </div>
        </div>

        <div class="api-section">
            <h3>üèãÔ∏è‚Äç‚ôÇÔ∏è Exercise Journal API Tests</h3>
            <div class="api-test">
                <button onclick="testLogExerciseSession()">Test Log Exercise Session</button>
                <div id="exercise-log-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testExerciseHistory()">Test Exercise History</button>
                <div id="exercise-history-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testSetExerciseGoal()">Test Set Exercise Goal</button>
                <div id="exercise-goal-results" class="result"></div>
            </div>
            <div class="api-test">
                <button onclick="testExerciseAnalytics()">Test Exercise Analytics</button>
                <div id="exercise-analytics-results" class="result"></div>
            </div>
        </div>

        <!-- Weight Tracker Component will be inserted here -->
        <div id="weight-tracker-container"></div>

        <!-- Exercise Journal Component will be inserted here -->
        <div id="exercise-journal-container"></div>
    </div>

    <script src="FamilyFriends.js"></script>
    <script src="SharedWorkout.js"></script>
    <script src="WeightTracker.js"></script>
    <script src="ExerciseJournal.js"></script>
    <script>
        const API_BASE = 'http://localhost:8000';

        async function testAPIStatus() {
            const resultDiv = document.getElementById('api-status');
            try {
                resultDiv.textContent = 'Testing API connection...';
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                resultDiv.innerHTML = `<span class="success">‚úÖ API Connected Successfully!</span>\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå API Connection Failed:</span>\n${error.message}`;
            }
        }

        async function testFamilyFeatures() {
            const resultDiv = document.getElementById('family-results');
            try {
                resultDiv.textContent = 'Testing family & friends features...';
                
                // Test community discovery
                const response = await fetch(`${API_BASE}/api/community/discover?fitness_interests=strength,cardio`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Family Features Working!</span>\nDiscovered ${data.total_found} community groups\n${JSON.stringify(data.discovered_groups.slice(0, 2), null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Family Features Test Failed:</span>\n${error.message}`;
            }
        }

        async function testSkillSharing() {
            const resultDiv = document.getElementById('skill-results');
            try {
                resultDiv.textContent = 'Testing skill sharing features...';
                
                const response = await fetch(`${API_BASE}/api/skills/available-sessions`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Phase 2: Skill Sharing Active!</span>\nFound ${data.total_sessions} skill sessions\nSkill Categories: ${data.skill_categories.join(', ')}\n${JSON.stringify(data.upcoming_highlights, null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Skill Sharing Test Failed:</span>\n${error.message}`;
            }
        }

        async function testMentorship() {
            const resultDiv = document.getElementById('mentor-results');
            try {
                resultDiv.textContent = 'Testing mentor matching...';
                
                const mentorRequest = {
                    mentee_id: "test_user_123",
                    fitness_goals: ["strength", "nutrition"],
                    experience_level: "beginner",
                    preferred_mentor_qualities: ["patient", "experienced"],
                    availability: ["weekday_evenings"]
                };

                const response = await fetch(`${API_BASE}/api/mentorship/find-mentor`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(mentorRequest)
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Phase 2: Mentor Matching Active!</span>\nFound ${data.matches_found} potential mentors\nTop Match: ${data.recommended_mentors[0]?.name} (${data.recommended_mentors[0]?.match_score}% compatibility)\n${JSON.stringify(data.recommended_mentors[0], null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Mentor Matching Test Failed:</span>\n${error.message}`;
            }
        }

        async function testPartnerMatching() {
            const resultDiv = document.getElementById('partner-results');
            try {
                resultDiv.textContent = 'Testing workout partner matching...';
                
                const partnerRequest = {
                    user_id: "test_user_123",
                    workout_type: "strength",
                    preferred_time: "now",
                    experience_level: "intermediate",
                    workout_duration: 60
                };

                const response = await fetch(`${API_BASE}/api/partners/find-workout-buddy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(partnerRequest)
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Phase 3: Partner Coordination Active!</span>\nFound ${data.partners_found} available partners\nBest Match: ${data.available_partners[0]?.name} (${data.available_partners[0]?.compatibility_score}% compatibility)\n${JSON.stringify(data.available_partners[0], null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Partner Matching Test Failed:</span>\n${error.message}`;
            }
        }

        async function testCommunityFeatures() {
            const resultDiv = document.getElementById('community-results');
            try {
                resultDiv.textContent = 'Testing community discovery...';
                
                const response = await fetch(`${API_BASE}/api/community/discover?fitness_interests=strength,yoga&experience_level=intermediate&distance_km=25`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Phase 3: Community Discovery Active!</span>\nFound ${data.total_found} community groups\nTop Match: ${data.discovered_groups[0]?.name} (${data.discovered_groups[0]?.compatibility_score}% compatibility)\n${JSON.stringify(data.discovered_groups[0], null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Community Discovery Test Failed:</span>\n${error.message}`;
            }
        }

        async function testLeaderboards() {
            const resultDiv = document.getElementById('leaderboard-results');
            try {
                resultDiv.textContent = 'Testing community leaderboards...';
                
                const response = await fetch(`${API_BASE}/api/community/leaderboards`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Community Leaderboards Active!</span>\nCommunity Stats:\n- Total Members: ${data.community_stats.total_members}\n- Active Instructors: ${data.community_stats.active_instructors}\n- Available Mentors: ${data.community_stats.available_mentors}\n- Avg Rating: ${data.community_stats.average_community_rating}/5.0\n\nTop Instructor: ${data.leaderboards.top_instructors[0]?.name} (${data.leaderboards.top_instructors[0]?.average_rating}/5.0)`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Leaderboards Test Failed:</span>\n${error.message}`;
            }
        }

        async function testWeightLogging() {
            const resultDiv = document.getElementById('weight-log-results');
            try {
                resultDiv.textContent = 'Testing weight logging...';
                
                const weightData = {
                    user_id: "test_user_123",
                    weight: 75.5,
                    unit: "kg",
                    notes: "Morning weigh-in after workout",
                    share_with_groups: ["family_group_1"],
                    privacy_level: "family",
                    goal_weight: 72.0
                };

                const response = await fetch(`${API_BASE}/api/weight/log`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(weightData)
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Weight Tracking Active!</span>\n${data.message}\nAnalytics: ${data.analytics.trend} trend, ${data.analytics.entries_count} total entries\n${JSON.stringify(data.entry, null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Weight Logging Test Failed:</span>\n${error.message}`;
            }
        }

        async function testWeightHistory() {
            const resultDiv = document.getElementById('weight-history-results');
            try {
                resultDiv.textContent = 'Testing weight history...';
                
                const response = await fetch(`${API_BASE}/api/weight/history/test_user_123`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Weight History Loaded!</span>\nTotal Entries: ${data.total_entries}\nAnalytics: ${data.analytics.current_weight} kg current, ${data.analytics.total_change.toFixed(1)} kg total change\nStreak: ${data.analytics.streak_days} days\n${JSON.stringify(data.analytics, null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Weight History Test Failed:</span>\n${error.message}`;
            }
        }

        async function testFamilyWeightProgress() {
            const resultDiv = document.getElementById('family-weight-results');
            try {
                resultDiv.textContent = 'Testing family weight progress...';
                
                const response = await fetch(`${API_BASE}/api/weight/family/family_group_1`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Family Weight Progress Loaded!</span>\nFamily Members: ${data.group_stats.total_members}\nActive Members: ${data.group_stats.active_members}\nCombined Loss: ${data.group_stats.combined_loss.toFixed(1)} kg\n${JSON.stringify(data.family_progress[0], null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Family Progress Test Failed:</span>\n${error.message}`;
            }
        }

        // Auto-test API status on page load
        window.addEventListener('load', function() {
            testAPIStatus();
        });

        // Exercise Journal API Tests
        async function testLogExerciseSession() {
            const resultDiv = document.getElementById('exercise-log-results');
            try {
                resultDiv.textContent = 'Testing exercise logging...';
                
                const exerciseData = {
                    user_id: 'test_user_123',
                    workout_date: new Date().toISOString().split('T')[0],
                    workout_type: 'strength',
                    session_name: 'Push Day Test',
                    exercises: [
                        {
                            exercise_name: 'Bench Press',
                            sets: 3,
                            reps: [12, 10, 8],
                            weight: [60, 65, 70],
                            rpe: [7, 8, 9],
                            rest_time: [90, 120, 120],
                            form_notes: 'Focus on controlled descent',
                            technique_focus: 'Pause at chest',
                            personal_record: true
                        }
                    ],
                    total_duration_minutes: 45,
                    overall_notes: 'Great session, felt strong',
                    energy_level: 8,
                    motivation_level: 9,
                    share_with_groups: [],
                    privacy_level: 'private',
                    tags: ['strength', 'chest', 'pr']
                };
                
                const response = await fetch(`${API_BASE}/api/exercises/log`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(exerciseData)
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `
                    <strong>Exercise Logged:</strong><br>
                    Success: ${data.success}<br>
                    Entry ID: ${data.entry_id || 'N/A'}<br>
                    Total Exercises: ${data.session_summary?.total_exercises || 0}<br>
                    Total Sets: ${data.session_summary?.total_sets || 0}<br>
                    Total Volume: ${data.session_summary?.total_volume || 0}kg<br>
                    Personal Records: ${data.personal_records?.length || 0}<br>
                    Message: ${data.message || data.error || 'No message'}
                `;
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testExerciseHistory() {
            const resultDiv = document.getElementById('exercise-history-results');
            try {
                resultDiv.textContent = 'Loading exercise history...';
                
                const response = await fetch(`${API_BASE}/api/exercises/history/test_user_123?days=7`);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <strong>Exercise History:</strong><br>
                    Success: ${data.success}<br>
                    Total Sessions: ${data.total_sessions || 0}<br>
                    History Entries: ${data.exercise_history?.length || 0}<br>
                    Analytics Available: ${data.analytics ? 'Yes' : 'No'}<br>
                    Performance Insights: ${data.performance_insights?.length || 0}
                `;
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testSetExerciseGoal() {
            const resultDiv = document.getElementById('exercise-goal-results');
            try {
                resultDiv.textContent = 'Setting exercise goal...';
                
                const goalData = {
                    user_id: 'test_user_123',
                    exercise_name: 'Bench Press',
                    goal_type: 'strength',
                    target_weight: 80,
                    target_reps: null,
                    target_date: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    current_max: 70,
                    notes: 'Want to hit 80kg by end of quarter'
                };
                
                const response = await fetch(`${API_BASE}/api/exercises/set-goal`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(goalData)
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <strong>Exercise Goal Set:</strong><br>
                    Success: ${data.success}<br>
                    Goal ID: ${data.goal_id || 'N/A'}<br>
                    Exercise: ${data.goal_details?.exercise_name || 'N/A'}<br>
                    Target: ${data.goal_details?.target_weight || 'N/A'}kg<br>
                    Timeline: ${data.timeline_estimate || 'N/A'}<br>
                    Message: ${data.message || data.error || 'No message'}
                `;
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testExerciseAnalytics() {
            const resultDiv = document.getElementById('exercise-analytics-results');
            try {
                resultDiv.textContent = 'Loading exercise analytics...';
                
                const response = await fetch(`${API_BASE}/api/exercises/analytics/test_user_123`);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <strong>Exercise Analytics:</strong><br>
                    Success: ${data.success}<br>
                    Overall Trend: ${data.analytics?.strength_trends?.overall_trend || 'N/A'}<br>
                    Monthly Improvement: ${data.analytics?.strength_trends?.monthly_improvement || 'N/A'}<br>
                    Sessions This Month: ${data.analytics?.consistency_metrics?.sessions_this_month || 0}<br>
                    Current Streak: ${data.analytics?.consistency_metrics?.current_streak || 0}<br>
                    Total Volume: ${data.analytics?.volume_analysis?.total_volume_last_month || 0}kg
                `;
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then((registration) => {
                    console.log('PWA ServiceWorker registered for test page:', registration);
                })
                .catch((error) => {
                    console.log('PWA ServiceWorker registration failed:', error);
                });
        }

        // PWA Install Prompt for Test Page
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Add install prompt to the test page
            const testControls = document.querySelector('.test-section');
            if (testControls) {
                const installDiv = document.createElement('div');
                installDiv.innerHTML = `
                    <div style="background: linear-gradient(45deg, #1e40af, #10b981); color: white; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                        <h4 style="margin: 0 0 10px 0;">üì± Install Khyrie Fitness App</h4>
                        <p style="margin: 0 0 10px 0; font-size: 14px;">Get the full native app experience with offline support!</p>
                        <button onclick="installTestPWA()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 10px;">Install App</button>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Not Now</button>
                    </div>
                `;
                testControls.appendChild(installDiv);
            }
        });

        // Install PWA function for test page
        window.installTestPWA = async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.choiceResult;
                console.log('Test page PWA install result:', outcome);
                deferredPrompt = null;
            }
        };

    </script>
</body>
</html>